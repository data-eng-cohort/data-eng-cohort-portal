<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Portal Login</title>
  <script type="module" src="./firebase.js"></script>
</head>
<body>
  <h2>Login / Signup</h2>
  <input id="email" placeholder="Email"><br>
  <input id="password" type="password" placeholder="Password"><br>
  <button id="loginBtn">Login</button>
  <button id="signupBtn">Sign Up</button>
  <p id="error" style="color:red"></p>

  <script type="module">
    import { auth, db, signInWithEmailAndPassword, createUserWithEmailAndPassword, doc, setDoc } from './firebase.js';

    const err = document.getElementById("error");

    document.getElementById("signupBtn").addEventListener("click", async () => {
      try {
        const email = emailInput.value;
        const pass = passwordInput.value;
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        // default role learner
        await setDoc(doc(db, "users", cred.user.uid), { email, role: "learner" });
        alert("Account created! You can login now.");
      } catch (e) {
        err.textContent = e.message;
      }
    });

    document.getElementById("loginBtn").addEventListener("click", async () => {
      try {
        const cred = await signInWithEmailAndPassword(auth, email.value, password.value);
        const uid = cred.user.uid;
        const snap = await getDoc(doc(db, "users", uid));
        if (!snap.exists()) { err.textContent = "Profile not found."; return; }
        const role = snap.data().role;
        if (role === "admin") window.location.href = "admin.html";
        else window.location.href = "learner.html";
      } catch (e) {
        err.textContent = e.message;
      }
    });
  </script>
</body>
</html>
