<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Learning Portal | Data Engineering Cohort</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Poppins", sans-serif; }
    body { background: #f4f7fb; color: #333; }

    /* NAVBAR */
    nav {
      background: linear-gradient(135deg, #00b894, #00a36c);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 40px;
      font-size: 18px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    nav .logo { font-weight: 600; font-size: 20px; }
    nav .logout {
      background: #fff; color: #00a36c; border: none;
      padding: 8px 18px; border-radius: 6px;
      font-weight: 500; cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,163,108,0.2);
      transition: all 0.3s ease;
    }
    nav .logout:hover { background: #e9f9f3; transform: scale(1.05); }

    /* MAIN CONTAINER */
    .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
    h2 { color: #00a36c; text-align: center; margin-bottom: 30px; font-weight: 600; }

    /* GRID */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 25px;
      justify-items: center;
    }

    /* MODULE CARD (smaller & square) */
    .module-card {
      background: white;
      border-radius: 12px;
      border: 1.5px solid #e0e0e0;
      box-shadow: 0 3px 10px rgba(0,0,0,0.05);
      width: 100%;
      height: 140px;               /* smaller height */
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: #00a36c;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .module-card:hover {
      transform: translateY(-4px);
      border-color: #00a36c;
      box-shadow: 0 6px 15px rgba(0,163,108,0.15);
    }

    /* VIDEO CARD */
    .video-card {
      background: white;
      border-radius: 12px;
      border: 1.5px solid #e0e0e0;
      box-shadow: 0 3px 10px rgba(0,0,0,0.05);
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
      width: 100%;
    }
    .video-card:hover { transform: translateY(-4px); border-color: #00a36c; }
    .video-card h4 { font-size: 16px; color: #111; margin-bottom: 6px; }
    .video-card p { color: #555; font-size: 13px; margin-bottom: 12px; }

    /* BUTTONS */
    .play-btn, .download-btn, .home-btn {
      display: inline-block;
      margin-top: 6px;
      padding: 8px 20px;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      text-decoration: none;
      transition: all 0.3s ease;
    }
    .play-btn { background-color: #0078d7; }
    .download-btn { background-color: #28a745; margin-left: 4px; }
    .home-btn {
      background: linear-gradient(135deg, #00b894, #00a36c);
      margin-bottom: 25px;
    }
    .play-btn:hover, .download-btn:hover, .home-btn:hover { opacity: 0.9; transform: scale(1.03); }

    /* RESPONSIVE */
    @media (max-width: 1024px) { .grid { grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); } }
    @media (max-width: 768px)  { .grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); } }
    @media (max-width: 480px)  {
      .grid { grid-template-columns: 1fr; }
      .play-btn, .download-btn { width: 100%; }
      .module-card { height: 120px; font-size: 16px; }
    }
  </style>
</head>

<body>
  <nav>
    <div class="logo">Data Engineering Cohort</div>
		<div class"logo"> Welcome, <span id="user-name"></span> üëã </div>
		  <!-- <h2>Welcome, <span id="user-name"></span> üëã</h2> -->
    <button class="logout" onclick="logout()">Logout</button>
  </nav>

  <div class="container">

    <!-- Module Section -->
    <div id="module-section">
      <div id="module-grid" class="grid"></div>
    </div>

    <!-- Video Section -->
    <div id="video-section" style="display:none;">
      <div style="text-align:center;">
        <button class="home-btn" onclick="showModules()">üè† Back to Home</button>
      </div>
      <h2 id="module-title"></h2>
      <div id="video-grid" class="grid"></div>
    </div>
  </div>
	<script>
  async function loadPortal() {
    const userId = localStorage.getItem("user_id");
    const userName = localStorage.getItem("user_name");
    if (!userId) return (window.location.href = "index.html");

    document.getElementById("user-name").innerText = userName;

    const response = await fetch("data.json");
    const data = await response.json();

    // üîπ Find the current user
    const user = data.users.find((u) => u.user_id == userId);
    if (!user) return alert("User not found!");

    // üîπ Extract module IDs the user has access to
    const userModuleIds = user.module_access.map((m) => m.module_id);

    // üîπ Filter only modules the user can access
    const userModules = data.modules.filter((m) =>
      userModuleIds.includes(m.module_id)
    );

    const moduleGrid = document.getElementById("module-grid");
    moduleGrid.innerHTML = "";

    // üîπ Render each accessible module
    userModules.forEach((m) => {
      const card = document.createElement("div");
      card.className = "module-card";
      card.innerText = m.module_name;

      card.onclick = () => showVideos(m, user);
      moduleGrid.appendChild(card);
    });
  }

  function showVideos(module, user) {
    document.getElementById("module-section").style.display = "none";
    document.getElementById("video-section").style.display = "block";

    const videoGrid = document.getElementById("video-grid");
    videoGrid.innerHTML = "";

    // üîπ Find this module's access entry for the user
    const moduleAccess = user.module_access.find((m) => m.module_id === module.module_id);
    if (!moduleAccess) {
      videoGrid.innerHTML = "<p>You don‚Äôt have access to this module‚Äôs videos.</p>";
      return;
    }

    // üîπ Get allowed video IDs for this module
    const allowedVideoIds = moduleAccess.videos;

    // üîπ Filter videos within the module based on user permission
    const accessibleVideos = module.videos.filter((v) =>
      allowedVideoIds.includes(v.video_id)
    );

    // üîπ Build video cards
    accessibleVideos.forEach((v) => {
      const card = document.createElement("div");
      card.className = "video-card";

      let html = `
        <h4>${v.title}</h4>
        <p>${v.description}</p>
        <a class="play-btn" href="https://drive.google.com/file/d/${v.drive_file_id}/preview" target="_blank">‚ñ∂ Play Video</a>
      `;

      if (v.resource_id && v.resource_id.trim() !== "") {
        html += `<br><a class="download-btn" href="https://drive.google.com/uc?export=download&id=${v.resource_id}" target="_blank">üì¶ Download</a>`;
      }

      card.innerHTML = html;
      videoGrid.appendChild(card);
    });
  }

  function showModules() {
    document.getElementById("video-section").style.display = "none";
    document.getElementById("module-section").style.display = "block";
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  function logout() {
    localStorage.clear();
    window.location.href = "index.html";
  }

  loadPortal();
</script>



  <!-- <script>
    async function loadPortal() {
      const userId = localStorage.getItem("user_id");
      const userName = localStorage.getItem("user_name");
      if (!userId) return (window.location.href = "index.html");

      document.getElementById("user-name").innerText = userName;

      const response = await fetch("data.json");
      const data = await response.json();

      const user = data.users.find((u) => u.user_id == userId);
      const userModules = data.modules.filter((m) => user.modules.includes(m.module_id));

      const moduleGrid = document.getElementById("module-grid");
      moduleGrid.innerHTML = "";

      userModules.forEach((m) => {
        const card = document.createElement("div");
        card.className = "module-card";
        card.innerText = m.module_name;
        card.onclick = () => showVideos(m, user);
        moduleGrid.appendChild(card);
      });
    }

    function showVideos(module, user) {
      document.getElementById("module-section").style.display = "none";
      document.getElementById("video-section").style.display = "block";
      // document.getElementById("module-title").innerText = module.module_name + " Videos";

      const videoGrid = document.getElementById("video-grid");
      videoGrid.innerHTML = "";

      const userVideos = module.videos.filter((v) => user.videos.includes(v.video_id));

      userVideos.forEach((v) => {
        const card = document.createElement("div");
        card.className = "video-card";

        let html = `
          <h4>${v.title}</h4>
          <p>${v.description}</p>
          <a class="play-btn" href="https://drive.google.com/file/d/${v.drive_file_id}/preview" target="_blank">‚ñ∂ Play Video</a>
        `;
        if (v.resource_id && v.resource_id.trim() !== "") {
          html += `<br><a class="download-btn" href="https://drive.google.com/uc?export=download&id=${v.resource_id}" target="_blank">üì¶ Download</a>`;
        }
        card.innerHTML = html;
        videoGrid.appendChild(card);
      });
    }

    function showModules() {
      document.getElementById("video-section").style.display = "none";
      document.getElementById("module-section").style.display = "block";
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function logout() {
      localStorage.clear();
      window.location.href = "index.html";
    }

    loadPortal();
  </script> -->
</body>
</html>
